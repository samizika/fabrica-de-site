###############################################################
# Workflow de Deploy & Garantia de Qualidade
# -------------------------------------------------------------
# Este workflow automatiza o processo de publica√ß√£o do projeto
# no GitHub Pages e pode ser expandido para incluir etapas de
# valida√ß√£o de qualidade, como testes e linters.
#
# Principais fun√ß√µes:
# - Publicar o site automaticamente ap√≥s altera√ß√µes na branch 'main'.
# - Cancelar execu√ß√µes concorrentes para evitar conflitos.
# - Permitir disparo manual do workflow.
# - Gerenciar permiss√µes de acesso necess√°rias para o deploy.
# - Definir ambiente e URL do site publicado.
#
# Para expandir este workflow, recomenda-se adicionar etapas de
# valida√ß√£o de c√≥digo, testes automatizados e notifica√ß√µes.
###############################################################
## Workflow de Deploy & Garantia de Qualidade
# Este workflow realiza o deploy autom√°tico do projeto para o GitHub Pages
# e executa etapas de garantia de qualidade sempre que h√° um push na branch 'main'.

###############################################################
# Nome do workflow exibido na interface do GitHub Actions.
###############################################################
name: üöÄ Deploy & Quality Assurance

###############################################################
# Eventos que disparam o workflow:
# - push: Executa automaticamente ao enviar altera√ß√µes para a branch 'main'.
# - workflow_dispatch: Permite execu√ß√£o manual pelo GitHub Actions.
###############################################################
## Eventos que disparam o workflow
# Executa quando h√° push na branch 'main' ou quando disparado manualmente.

on:
  push:
    branches:
      - main
  workflow_dispatch:

###############################################################
# Permiss√µes necess√°rias para o workflow:
# - contents: read -> Permite leitura dos arquivos do reposit√≥rio.
# - pages: write -> Permite publicar no GitHub Pages.
# - id-token: write -> Permite autentica√ß√£o segura para a√ß√µes.
###############################################################
## Permiss√µes necess√°rias para o workflow
# Permite leitura de conte√∫do, escrita nas p√°ginas e uso de id-token.

permissions:
  contents: read
  pages: write
  id-token: write

###############################################################
# Controle de concorr√™ncia:
# - Garante que apenas uma execu√ß√£o do workflow por branch ocorra ao mesmo tempo.
# - Cancela execu√ß√µes anteriores se uma nova for iniciada.
###############################################################
## Controle de concorr√™ncia
# Cancela execu√ß√µes anteriores do mesmo workflow/ref se houver uma nova execu√ß√£o.

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

###############################################################
# Defini√ß√£o dos jobs do workflow:
# - O job 'deploy' √© respons√°vel por todo o processo de publica√ß√£o.
# - Pode ser expandido para incluir outros jobs, como testes ou valida√ß√£o.
###############################################################
## Job principal de deploy
# Este job realiza o deploy do projeto para o GitHub Pages.
  # 'runs-on: ubuntu-latest' define o sistema operacional usado pelo runner.
  # 'if: github.ref == ...' garante que o deploy s√≥ ocorra na branch principal.
  # 'outputs' permite compartilhar a URL gerada do site para outros jobs.
  # O bloco 'environment' define o ambiente de publica√ß√£o e a URL do site.
  # O bloco 'steps' cont√©m todas as etapas executadas pelo job de deploy.
  # Cada etapa √© descrita abaixo:
  # Etapa 1: Checkout do c√≥digo
  # Baixa o c√≥digo do reposit√≥rio para o runner.
  # Etapa 2: Configura√ß√£o do GitHub Pages
  # Prepara o ambiente para publica√ß√£o no GitHub Pages.
  # Etapa 3: Upload dos artefatos
  # Envia os arquivos do projeto como artefato para serem publicados.
  # O par√¢metro 'path' define o diret√≥rio a ser enviado (neste caso, o projeto inteiro).
  # Etapa 4: Deploy para o GitHub Pages
  # Publica os artefatos enviados no ambiente do GitHub Pages.
  # O 'id: deployment' permite referenciar esta etapa para obter a URL publicada.

jobs:
  deploy:
    name: üöÄ Deploy to Github pages
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    outputs:
      page_url: ${{ steps.deployment.outputs.page_url }}

      # Define o ambiente de deploy e a URL da p√°gina publicada
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}

      # Etapas do job de deploy
      # 1. Checkout do c√≥digo
      # 2. Configura√ß√£o do GitHub Pages
      # 3. Upload dos artefatos para publica√ß√£o
      # 4. Deploy para o GitHub Pages
    steps:
      - name: üì• Checkout code
        uses: actions/checkout@v4

        # Configura o ambiente do GitHub Pages
      - name: üìÑ Setup Pages
        uses: actions/configure-pages@v4

        # Faz upload dos arquivos do projeto como artefato para publica√ß√£o
      - name: üì¶ Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: "."

        # Realiza o deploy dos artefatos para o GitHub Pages
      - name: üöÄ Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4